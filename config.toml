# Chat Application Configuration

# Server Configuration
[server]
port = 8080

# Chatbox Service Configuration
[chatbox]
# REQUIRED: Set via environment variable JWT_SECRET or Kubernetes secret
# Generate with: openssl rand -base64 32
jwt_secret = "PLACEHOLDER_JWT_SECRET"
reconnect_timeout = "15m"
max_connections = 10000
rate_limit = 100

# HTTP path prefix for all chatbox routes (default: "/chatbox")
# Set via environment variable CHATBOX_PATH_PREFIX or config file
# Must start with "/" (e.g., "/chatbox", "/api/chat", "/v1/chat")
# This allows running multiple services on the same domain with different paths
# Examples:
#   path_prefix = "/chatbox"        # Default - all routes under /chatbox/*
#   path_prefix = "/api/chat"       # All routes under /api/chat/*
#   path_prefix = "/v1/chat"        # All routes under /v1/chat/*
# Routes affected:
#   - WebSocket: {path_prefix}/ws
#   - User sessions: {path_prefix}/sessions
#   - Admin endpoints: {path_prefix}/admin/*
#   - Health checks: {path_prefix}/healthz, {path_prefix}/readyz
path_prefix = "/chatbox"

# Comma-separated list of allowed origins for WebSocket connections
# Example: "https://example.com,https://app.example.com"
# Leave empty to allow all origins (development mode only)
# SECURITY WARNING: Always configure this in production to prevent CSRF attacks
allowed_origins = ""

# Comma-separated list of allowed origins for CORS (HTTP endpoints like admin API, metrics)
# Example: "https://admin.example.com,https://dashboard.example.com"
# Leave empty to disable CORS middleware (endpoints only accessible from same origin)
# Use this to allow admin dashboards and monitoring tools from different domains
cors_allowed_origins = ""
# REQUIRED: Encryption key for message content at rest (must be 32 bytes for AES-256)
# Set via environment variable ENCRYPTION_KEY or Kubernetes secret
# Generate with: openssl rand -base64 32
encryption_key = "PLACEHOLDER_ENCRYPTION_KEY_32_BYTES"

# Maximum message size in bytes for WebSocket connections (default: 1048576 = 1MB)
# Set via environment variable MAX_MESSAGE_SIZE or config file
# This prevents denial-of-service attacks via oversized messages
max_message_size = "1048576"

# WebSocket Configuration
[chatbox.websocket]
read_buffer_size = 1024
write_buffer_size = 1024
pong_wait = "60s"
ping_period = "54s"
write_wait = "10s"

# Database Configuration (for gomongo)
[dbs]
verbose = 1
slowThreshold = 2

[dbs.chat]
uri = "mongodb://localhost:27017/chat"
database = "chat"
collection = "sessions"
connectTimeout = "10s"

# Connection sources for S3 (for goupload)
[connection_sources]
  [[connection_sources.s3_providers]]
    name = "aws-chat-storage"
    endpoint = "s3.us-east-1.amazonaws.com"
    # REQUIRED: Set via environment variable AWS_ACCESS_KEY_ID or Kubernetes secret
    key = "PLACEHOLDER_AWS_ACCESS_KEY"
    # REQUIRED: Set via environment variable AWS_SECRET_ACCESS_KEY or Kubernetes secret
    pass = "PLACEHOLDER_AWS_SECRET_KEY"
    region = "us-east-1"

# Upload configuration (for goupload)
[userupload]
site = "CHAT"
  [[userupload.types]]
    entryName = "uploads"
    prefix = "/chat-files"
    tmpPath = "./temp/uploads"
    maxSize = "100MB"
    storage = [
      { type = "s3", target = "aws-chat-storage", bucket = "chat-files" }
    ]

# LLM Providers Configuration
[chatbox.llm]
[[chatbox.llm.providers]]
id = "openai-gpt4"
name = "GPT-4"
type = "openai"
endpoint = "https://api.openai.com/v1"
# REQUIRED: Set via environment variable OPENAI_API_KEY or Kubernetes secret
apiKey = "PLACEHOLDER_OPENAI_API_KEY"
model = "gpt-4"

[[chatbox.llm.providers]]
id = "anthropic-claude"
name = "Claude"
type = "anthropic"
endpoint = "https://api.anthropic.com/v1"
# REQUIRED: Set via environment variable ANTHROPIC_API_KEY or Kubernetes secret
apiKey = "PLACEHOLDER_ANTHROPIC_API_KEY"
model = "claude-3-opus"

[[chatbox.llm.providers]]
id = "dify-assistant"
name = "Dify Assistant"
type = "dify"
endpoint = "https://api.dify.ai/v1"
# REQUIRED: Set via environment variable DIFY_API_KEY or Kubernetes secret
apiKey = "PLACEHOLDER_DIFY_API_KEY"
model = "assistant"

# Mail configuration (for gomail)
[mail]
defaultFromName = "Chat Support"
replyToEmail = "support@example.com"
adminEmail = "admin@example.com"

# SES Engine for production
[[mail.engines.ses]]
name = "ses-primary"
# REQUIRED: Set via environment variable AWS_SES_ACCESS_KEY_ID or Kubernetes secret
accessKeyId = "PLACEHOLDER_AWS_SES_ACCESS_KEY_ID"
# REQUIRED: Set via environment variable AWS_SES_SECRET_ACCESS_KEY or Kubernetes secret
secretAccessKey = "PLACEHOLDER_AWS_SES_SECRET_ACCESS_KEY"
region = "us-east-1"
from = "noreply@example.com"
fromName = "Chat System"

# SMTP Engine for backup
[[mail.engines.smtp]]
name = "smtp-backup"
host = "smtp.example.com"
port = 587
# REQUIRED: Set via environment variable SMTP_USER or Kubernetes secret
user = "PLACEHOLDER_SMTP_USER"
# REQUIRED: Set via environment variable SMTP_PASSWORD or Kubernetes secret
pass = "PLACEHOLDER_SMTP_PASSWORD"
from = "noreply@example.com"
fromName = "Chat System"

# Mock Engine for testing
[[mail.engines.mock]]
name = "mock"
verbose = true

# SMS Configuration (for gosms)
[sms]
provider = "twilio"
# REQUIRED: Set via environment variable TWILIO_ACCOUNT_SID or Kubernetes secret
accountSID = "PLACEHOLDER_TWILIO_ACCOUNT_SID"
# REQUIRED: Set via environment variable TWILIO_AUTH_TOKEN or Kubernetes secret
authToken = "PLACEHOLDER_TWILIO_AUTH_TOKEN"
fromNumber = "+1234567890"

# Notification Configuration
[notification]
adminEmails = ["admin@example.com"]
adminPhones = ["+1234567890"]

# Kubernetes Configuration
[kubernetes]
namespace = "default"
serviceName = "chat-websocket"
configMapName = "chat-config"
secretName = "chat-secrets"
enableK8sProbe = true

# Logging Configuration (for golog)
[log]
dir = "logs"
level = "info"
standardOutput = true
