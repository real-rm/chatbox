# github.com/real-rm/chatbox/internal/metrics.test
ld: warning: '/private/var/folders/zk/w7j55fl57bb3204z49k448300000gn/T/go-link-4069948523/000013.o' has malformed LC_DYSYMTAB, expected 98 undefined symbols to start at index 1626, found 95 undefined symbols starting at index 1626
# github.com/real-rm/chatbox/internal/llm.test
ld: warning: '/private/var/folders/zk/w7j55fl57bb3204z49k448300000gn/T/go-link-668243998/000013.o' has malformed LC_DYSYMTAB, expected 98 undefined symbols to start at index 1626, found 95 undefined symbols starting at index 1626
# github.com/real-rm/chatbox/internal/logging.test
ld: warning: '/private/var/folders/zk/w7j55fl57bb3204z49k448300000gn/T/go-link-2185131581/000013.o' has malformed LC_DYSYMTAB, expected 98 undefined symbols to start at index 1626, found 95 undefined symbols starting at index 1626
# github.com/real-rm/chatbox/internal/router.test
ld: warning: '/private/var/folders/zk/w7j55fl57bb3204z49k448300000gn/T/go-link-1168959235/000013.o' has malformed LC_DYSYMTAB, expected 98 undefined symbols to start at index 1626, found 95 undefined symbols starting at index 1626
# github.com/real-rm/chatbox/internal/storage.test
ld: warning: '/private/var/folders/zk/w7j55fl57bb3204z49k448300000gn/T/go-link-2950542624/000013.o' has malformed LC_DYSYMTAB, expected 98 undefined symbols to start at index 1626, found 95 undefined symbols starting at index 1626
# github.com/real-rm/chatbox.test
ld: warning: '/private/var/folders/zk/w7j55fl57bb3204z49k448300000gn/T/go-link-3940938236/000013.o' has malformed LC_DYSYMTAB, expected 98 undefined symbols to start at index 1626, found 95 undefined symbols starting at index 1626
# github.com/real-rm/chatbox/internal/testutil.test
ld: warning: '/private/var/folders/zk/w7j55fl57bb3204z49k448300000gn/T/go-link-998297921/000013.o' has malformed LC_DYSYMTAB, expected 98 undefined symbols to start at index 1626, found 95 undefined symbols starting at index 1626
# github.com/real-rm/chatbox/internal/websocket.test
ld: warning: '/private/var/folders/zk/w7j55fl57bb3204z49k448300000gn/T/go-link-2679393997/000013.o' has malformed LC_DYSYMTAB, expected 98 undefined symbols to start at index 1626, found 95 undefined symbols starting at index 1626
ok  	github.com/real-rm/chatbox	3.203s
ok  	github.com/real-rm/chatbox/cmd/server	5.354s
--- FAIL: TestProductionIssue06_PlaceholderSecrets (0.00s)
    secret_validation_test.go:69: SECURITY RISK: Found 17 placeholder secrets in secret.yaml:
    secret_validation_test.go:71:   - ENCRYPTION_KEY: CHANGE-ME-32-BYTE-KEY-FOR-AES256
    secret_validation_test.go:71:   - SMTP_USER: smtp-username
    secret_validation_test.go:71:   - SMS_AUTH_TOKEN: your-twilio-auth-token
    secret_validation_test.go:71:   - LLM_PROVIDER_2_API_KEY: sk-ant-your-anthropic-api-key
    secret_validation_test.go:71:   - LLM_PROVIDER_3_API_KEY: your-dify-api-key
    secret_validation_test.go:71:   - MONGO_USERNAME: chatbox-user
    secret_validation_test.go:71:   - SMS_ACCOUNT_SID: ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
    secret_validation_test.go:71:   - SMS_API_KEY: your-sms-api-key
    secret_validation_test.go:71:   - LLM_PROVIDER_1_API_KEY: sk-your-openai-api-key
    secret_validation_test.go:71:   - SES_SECRET_ACCESS_KEY: your-ses-secret-access-key
    secret_validation_test.go:71:   - S3_ACCESS_KEY_ID: your-s3-access-key-id
    secret_validation_test.go:71:   - S3_SECRET_ACCESS_KEY: your-s3-secret-access-key
    secret_validation_test.go:71:   - ADMIN_API_KEY: your-admin-api-key-for-monitoring
    secret_validation_test.go:71:   - SMTP_PASS: smtp-password
    secret_validation_test.go:71:   - SES_ACCESS_KEY_ID: AKIAXXXXXXXXXXXXXXXX
    secret_validation_test.go:71:   - MONGO_PASSWORD: your-mongo-password
    secret_validation_test.go:71:   - JWT_SECRET: your-jwt-secret-key-change-in-production-use-strong-random-string
    secret_validation_test.go:73: 
        Recommendations:
    secret_validation_test.go:74: 1. Generate strong random secrets for production deployment
    secret_validation_test.go:75: 2. Use secret management tools (e.g., Sealed Secrets, External Secrets Operator)
    secret_validation_test.go:76: 3. Never commit real secrets to version control
    secret_validation_test.go:77: 4. Implement secret rotation procedures
    secret_validation_test.go:78: 5. Use environment-specific secret values
    secret_validation_test.go:79: 
        For quick setup instructions, see: docs/SECRET_SETUP_QUICKSTART.md
FAIL
FAIL	github.com/real-rm/chatbox/deployments/kubernetes	0.768s
ok  	github.com/real-rm/chatbox/internal/auth	1.263s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/config	2.762s
ok  	github.com/real-rm/chatbox/internal/errors	2.445s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/httperrors	3.703s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/llm	2.032s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/logging	3.993s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/message	2.246s
ok  	github.com/real-rm/chatbox/internal/metrics	4.868s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/notification	4.314s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/ratelimit	5.031s
ok  	github.com/real-rm/chatbox/internal/router	3.852s
--- FAIL: TestProductionIssue12_ResponseTimesGrowth (0.02s)
    session_production_test.go:203: 
        	Error Trace:	/Users/fx/work/chatbox/internal/session/session_production_test.go:203
        	Error:      	Not equal: 
        	            	expected: 10000
        	            	actual  : 100
        	Test:       	TestProductionIssue12_ResponseTimesGrowth
        	Messages:   	All 10000 response times should be stored
    session_production_test.go:209: Recorded 100 response times
    session_production_test.go:210: Approximate memory usage: 800 bytes (0.78 KB)
    session_production_test.go:213: FINDING: ResponseTimes slice grows unbounded
    session_production_test.go:214: IMPACT: Long-running sessions accumulate large arrays
    session_production_test.go:215: RECOMMENDATION: Cap array size or use rolling window
FAIL
FAIL	github.com/real-rm/chatbox/internal/session	2.787s
==================
WARNING: DATA RACE
Read at 0x00c000330fb8 by goroutine 70:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:411 +0x778
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Previous write at 0x00c000330fb8 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:99 +0x78
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 70 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 83 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Write at 0x00c000330f40 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x1a4
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Previous read at 0x00c000330f40 by goroutine 70:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:361 +0x3c
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Goroutine 83 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 70 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Write at 0x00c000330fb8 by goroutine 77:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:99 +0x78
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Previous write at 0x00c000330fb8 by goroutine 88:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:99 +0x78
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 77 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 88 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Write at 0x00c000330f40 by goroutine 82:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x1a4
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Previous read at 0x00c000330f40 by goroutine 88:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x118
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 82 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 88 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Read at 0x00c0001a0010 by goroutine 88:
  runtime.growslice()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/runtime/slice.go:177 +0x0
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x148
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Previous write at 0x00c0001a0010 by goroutine 75:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x164
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 88 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 75 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Write at 0x00c000330f40 by goroutine 88:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x1a4
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Previous write at 0x00c000330f40 by goroutine 77:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x1a4
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 88 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 77 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Read at 0x00c0001301a0 by goroutine 69:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:362 +0xc0
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Previous write at 0x00c0001301a0 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x164
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 69 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 83 (finished) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Read at 0x00c000118a20 by goroutine 69:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:364 +0xf0
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Previous write at 0x00c000118a20 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x9c
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 69 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 83 (finished) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Read at 0x00c000118a30 by goroutine 69:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:365 +0x108
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Previous write at 0x00c000118a30 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x9c
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 69 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 83 (finished) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Read at 0x00c000118a48 by goroutine 69:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:366 +0x124
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Previous write at 0x00c000118a48 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x9c
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 69 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 83 (finished) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Read at 0x00c000118a58 by goroutine 69:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:367 +0x138
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Previous write at 0x00c000118a58 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x9c
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 69 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 83 (finished) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Read at 0x00c000118a68 by goroutine 69:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:368 +0x14c
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Previous write at 0x00c000118a68 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x9c
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 69 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 83 (finished) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Read at 0x00c000118a78 by goroutine 69:
  github.com/real-rm/chatbox/internal/storage.(*StorageService).sessionToDocument()
      /Users/fx/work/chatbox/internal/storage/storage.go:369 +0x160
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func1()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:89 +0x74

Previous write at 0x00c000118a78 by goroutine 83:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x9c
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 69 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:87 +0x368
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 83 (finished) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
==================
WARNING: DATA RACE
Write at 0x00c000814060 by goroutine 74:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x164
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Previous write at 0x00c000814060 by goroutine 113:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.func2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:100 +0x164
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace.gowrap2()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:103 +0x40

Goroutine 74 (running) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c

Goroutine 113 (finished) created at:
  github.com/real-rm/chatbox/internal/storage.TestProductionIssue10_SerializationDataRace()
      /Users/fx/work/chatbox/internal/storage/storage_production_test.go:96 +0x478
  testing.tRunner()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1934 +0x164
  testing.(*T).Run.gowrap1()
      /opt/homebrew/Cellar/go/1.25.6/libexec/src/testing/testing.go:1997 +0x3c
==================
--- FAIL: TestProductionIssue10_SerializationDataRace (0.00s)
    storage_production_test.go:108: FINDING: sessionToDocument accesses fields without locking
    storage_production_test.go:109: IMPACT: Potential data race when serializing during modifications
    storage_production_test.go:110: RECOMMENDATION: Document that caller must ensure thread-safety
    storage_production_test.go:111: RECOMMENDATION: Or add locking within sessionToDocument
    testing.go:1617: race detected during execution of test
FAIL
FAIL	github.com/real-rm/chatbox/internal/storage	4.623s
ok  	github.com/real-rm/chatbox/internal/testutil	4.985s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/upload	4.909s [no tests to run]
ok  	github.com/real-rm/chatbox/internal/websocket	4.327s
FAIL
